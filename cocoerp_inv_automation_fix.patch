diff --git a/AppCore.js b/AppCore.js
--- a/AppCore.js
+++ b/AppCore.js
@@ -1482,8 +1482,9 @@
 
     const shipFlag = String(dp.getProperty(APP.INTERNAL.SHIP_CN_UAE_SYNC_FLAG) || '');
 
-    if (!ordersForceAll && !ordersRaw && !qcForceAll && !qcRaw && shipFlag !== '1') return;
-
+    const qcInvFlag0 = String(dp.getProperty(APP.INTERNAL.QC_INV_SYNC_FLAG) || '');
+    const shipUaeEgInvFlag0 = String(dp.getProperty(APP.INTERNAL.SHIP_UAE_EG_INV_SYNC_FLAG) || '');
+    if (!ordersForceAll && !ordersRaw && !qcForceAll && !qcRaw && shipFlag !== '1' && qcInvFlag0 !== '1' && shipUaeEgInvFlag0 !== '1') return;
     const snapshot = {
       ordersForceAll: ordersForceAll ? '1' : '',
       ordersRaw: ordersRaw || '',
@@ -1525,6 +1526,7 @@
         if (typeof qc_generateFromPurchases_ === 'function') {
           qc_generateFromPurchases_();
           try { dp.setProperty(APP.INTERNAL.QC_GEN_LAST_RUN, new Date().toISOString()); } catch (e) {}
+          try { dp.setProperty(APP.INTERNAL.QC_INV_SYNC_FLAG, '1'); } catch (e) {}
         } else {
           dp.setProperty(APP.INTERNAL.QC_GEN_ALL_FLAG, '1');
           dp.setProperty(APP.INTERNAL.QC_GEN_LAST_ERROR, 'qc_generateFromPurchases_ is not defined.');
@@ -1542,6 +1544,7 @@
           if (typeof qc_generateFromPurchases_ === 'function') {
             qc_generateFromPurchases_(batch);
             try { dp.setProperty(APP.INTERNAL.QC_GEN_LAST_RUN, new Date().toISOString()); } catch (e) {}
+            try { dp.setProperty(APP.INTERNAL.QC_INV_SYNC_FLAG, '1'); } catch (e) {}
           } else {
             // restore queue for retry
             dp.setProperty(APP.INTERNAL.QC_GEN_QUEUE_KEY, snapshot.qcRaw);
diff --git a/Orders.js b/Orders.js
--- a/Orders.js
+++ b/Orders.js
@@ -30,7 +30,7 @@
 
 function orders_tryGetUi_() {
   try {
-    return SpreadsheetApp.getUi();
+    return (SpreadsheetApp.getUi ? SpreadsheetApp.getUi() : null);
   } catch (e) {
     return null; // Trigger / time-driven context
   }
@@ -40,7 +40,7 @@
   var text = String(msg);
   var ui = orders_tryGetUi_();
   if (ui) {
-    ui.alert(text);
+    if (ui) ui.alert(text); else if (typeof safeAlert_ === 'function') safeAlert_(text); else Logger.log(text);
     return;
   }
   if (typeof safeAlert_ === 'function') {
@@ -90,7 +90,7 @@
     const shO = orders_ensureSheet_(APP.SHEETS.ORDERS);
     const ui = orders_tryGetUi_();
     if (!ui) throw new Error('This action requires UI (run from spreadsheet menu).');
-    const res = ui.alert('تحذير', 'ده هيمسح Orders بالكامل. متأكد؟', ui.ButtonSet.YES_NO);
+    const res = if (ui) ui.alert('تحذير', 'ده هيمسح Orders بالكامل. متأكد؟', ui.ButtonSet.YES_NO); else if (typeof safeAlert_ === 'function') safeAlert_('تحذير', 'ده هيمسح Orders بالكامل. متأكد؟', ui.ButtonSet.YES_NO); else Logger.log('تحذير', 'ده هيمسح Orders بالكامل. متأكد؟', ui.ButtonSet.YES_NO);
     if (res !== ui.Button.YES) return;
 
     orders_removeFilterIfAny_(shO);
diff --git a/InventoryCore.js b/InventoryCore.js
--- a/InventoryCore.js
+++ b/InventoryCore.js
@@ -75,7 +75,9 @@
     setupInventorySnapshotUAE_();
     setupInventorySnapshotEG_();
 
-    SpreadsheetApp.getUi().alert(
+    if (typeof safeAlert_ === 'function') safeAlert_(
+      'تم تجهيز Inventory_Transactions و Inventory_UAE و Inventory_EG ✔️'
+    ); else Logger.log(
       'تم تجهيز Inventory_Transactions و Inventory_UAE و Inventory_EG ✔️'
     );
   } catch (e) {
@@ -136,7 +138,7 @@
 
     inv_repairInventoryTransactionsHeaders_(ledgerSh);
 
-    SpreadsheetApp.getUi().alert('Inventory_Transactions headers repaired ✔️');
+    if (typeof safeAlert_ === 'function') safeAlert_('Inventory_Transactions headers repaired ✔️'); else Logger.log('Inventory_Transactions headers repaired ✔️');
   } catch (e) {
     logError_('inv_repairInventoryTransactionsHeaders', e);
     throw e;
@@ -385,8 +387,7 @@
   // Map payload keys by header label (canonical)
   const keyByHeader = {};
   keyByHeader[APP.COLS.INV_TXNS.TXN_DATE]    = 'txnDate';
-  keyByHeader[APP.COLS.INV_TXNS.TYPE]        = 'type';
-  keyByHeader[APP.COLS.INV_TXNS.SOURCE_TYPE] = 'sourceType';
+keyByHeader[APP.COLS.INV_TXNS.SOURCE_TYPE] = 'sourceType';
   keyByHeader[APP.COLS.INV_TXNS.SOURCE_ID]   = 'sourceId';
   keyByHeader[APP.COLS.INV_TXNS.BATCH_CODE]  = 'batchCode';
   keyByHeader[APP.COLS.INV_TXNS.SKU]         = 'sku';
